<%- include('../partials/header', { pageTitle: 'One City Events', styles: '../../../css/styles.css', event: '../../../css/event.css'}) %>


<div class="rent-venue-application d-flex justify-content-center align-items-center ">
    <div class="container">
        <!-- Search Box and Add New Event Button -->
        <div class="row justify-content-center">
            <div class="col-lg-8 mb-4">
                <div class="search-box p-4 bg-light rounded shadow-sm text-center">
                    <h3 class="mb-0">Edit Event</h3>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Contact Form -->
                <div class="contact-form bg-white p-4 rounded shadow-sm">
                    <form id="contact" action="/admin/events/edit/<%= event._id %>?_method=PUT" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="_method" value="PUT"> <!-- Enables PUT method -->
                        
                        <div class="row g-3">
                            <!-- Title -->
                            <div class="col-12">
                                <div class="form-floating">
                                    <input name="title" type="text" class="form-control" id="title" placeholder="Title*" required value="<%= event.title %>">
                                    <label for="title">Title*</label>
                                </div>
                            </div>
                    
                            <!-- Description -->
                            <div class="col-12">
                                <div class="form-floating">
                                    <input name="description" type="text" class="form-control" id="description" placeholder="Description*" required value="<%= event.description %>">
                                    <label for="description">Description*</label>
                                </div>
                            </div>
                    
                            <!-- Max Attendees -->
                            <div class="col-12">
                                <div class="form-floating">
                                    <input name="maxAttendees" type="number" class="form-control" id="maxAttendees" placeholder="Max Attendees*" required value="<%= event.maxAttendees %>">
                                    <label for="maxAttendees">Max Attendees*</label>
                                </div>
                            </div>
                    
                            <!-- Event Date -->
                            <div class="col-12">
                                <div class="form-floating">
                                    <input name="eventDate" type="datetime-local" class="form-control" id="eventDate" 
                                        value="<%= event.eventDateTime ? event.eventDateTime.toISOString().slice(0, 16) : '' %>">
                                    <label for="eventDate">Event Date and Time*</label>
                                </div>
                            </div>
                    
                            <!-- Location -->
                            <div class="col-12">
                                <div class="form-floating">
                                    <input name="location" type="text" class="form-control" id="location" placeholder="Location*" required value="<%= event.location %>">
                                    <label for="location">Location*</label>
                                </div>
                            </div>
                    
                            <!-- Current Image and File Upload -->
                            <div class="col-12">
                                <div class="mb-3 text-center">
                                    <label for="eventImage" class="form-label">Current Image:</label>
                                    <br>
                                    <img src="<%= event.imageUrl %>" alt="Event Image" class="img-thumbnail" style="max-width: 150px;">
                                    <br><br>
                                    <input name="eventImage" type="file" class="form-control" id="eventImage">
                                    <div class="form-text">(Leave blank to keep the current image)</div>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Buttons Section -->
                        <div class="button-container mt-4 text-center">
                            <button type="submit" id="form-submit" class="btn btn-dark w-100">Update Event</button>
                        </div>
                    </form>
                
                    <!-- Archive/Unarchive Event Form -->
                    <div class="button-container mt-3 text-center">
                        <% if (event.isArchived) { %>
                            <form action="/admin/events/unarchive/<%= event._id %>" method="post">
                                <button type="submit" class="btn btn-outline-dark w-100">Unarchive Event</button>
                            </form>
                        <% } else { %>
                            <form action="/admin/events/archive/<%= event._id %>" method="post">
                                <button type="submit" class="btn btn-outline-dark w-100">Archive Event</button>
                            </form>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>
